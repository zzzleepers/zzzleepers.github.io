<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åšå®¢ç›®å½• - æ²æ³½çš„åšå®¢</title>
    <!-- å¼•å…¥å¤–éƒ¨èµ„æº -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- å¼•å…¥é€šç”¨æ ·å¼è¡¨ï¼ˆä¸åšå®¢æ–‡ç« å…±ç”¨ï¼‰ -->
    <link rel="stylesheet" href="blog-style.css">
    <script>
        // GitHub ä»“åº“é…ç½®ï¼ˆæ ¹æ®å®é™…ä»“åº“ä¿®æ”¹ï¼Œå½“å‰é€‚é… zzzleeper.github.ioï¼‰
        const GITHUB_CONFIG = {
            owner: "zzzleepers",
            repo: "zzzleepers.github.io",
            baseDir: "blog/" // åšå®¢æ–‡ä»¶æ‰€åœ¨æ ¹ç›®å½•
        };

        // å½“å‰æµè§ˆè·¯å¾„ï¼ˆåˆå§‹ä¸ºæ ¹ç›®å½•ï¼‰
        let currentPath = "";
        // ç¼“å­˜å·²è·å–çš„ç›®å½•æ•°æ®ï¼Œé¿å…é‡å¤è¯·æ±‚
        const dirCache = new Map();

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ç›®å½•
        document.addEventListener('DOMContentLoaded', async () => {
            await renderBlogList();
        });

        /**
         * ä» GitHub API è·å–æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ—è¡¨
         * @param {string} path - ç›®æ ‡è·¯å¾„ï¼ˆç›¸å¯¹äº blog/ ç›®å½•ï¼‰
         * @returns {Array} æ ¼å¼åŒ–åçš„æ–‡ä»¶/æ–‡ä»¶å¤¹æ•°æ®
         */
        async function fetchGithubFiles(path = "") {
            // ä¼˜å…ˆä»ç¼“å­˜è·å–
            if (dirCache.has(path)) {
                return dirCache.get(path);
            }

            try {
                // GitHub API æ¥å£ï¼šè·å–ä»“åº“ç›®å½•å†…å®¹
                const apiUrl = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.baseDir}${path}`;
                const response = await fetch(apiUrl);

                // å¤„ç† API å“åº”é”™è¯¯
                if (!response.ok) {
                    throw new Error(`è·å–ç›®å½•å¤±è´¥ï¼ˆ${response.status}ï¼‰`);
                }

                const rawData = await response.json();
                // æ ¼å¼åŒ–æ•°æ®ï¼ˆç­›é€‰ HTML æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œæ’é™¤æ— ç”¨æ–‡ä»¶ï¼‰
                const formattedData = rawData
                    .filter(item => {
                        // åªä¿ç•™ HTML æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œæ’é™¤éšè—æ–‡ä»¶ï¼ˆä»¥ . å¼€å¤´ï¼‰
                        return (item.type === "file" && item.name.endsWith(".html")) || 
                               (item.type === "dir" && !item.name.startsWith("."));
                    })
                    .map(item => ({
                        name: item.type === "file" ? item.name.replace(".html", "") : item.name, // ç§»é™¤ HTML åç¼€
                        path: item.path.replace(GITHUB_CONFIG.baseDir, ""), // ç›¸å¯¹è·¯å¾„ï¼ˆä¸å« blog/ å‰ç¼€ï¼‰
                        fullPath: item.path, // å®Œæ•´ä»“åº“è·¯å¾„
                        type: item.type, // file/dir
                        updated: new Date(item.updated_at).getTime(), // æ—¶é—´æˆ³ï¼ˆç”¨äºæ’åºï¼‰
                        updatedAt: item.updated_at // åŸå§‹æ›´æ–°æ—¶é—´ï¼ˆå¤‡ç”¨ï¼‰
                    }));

                // ç¼“å­˜æ•°æ®
                dirCache.set(path, formattedData);
                return formattedData;
            } catch (error) {
                console.error("GitHub API è¯·æ±‚é”™è¯¯ï¼š", error);
                // é”™è¯¯æ—¶æ˜¾ç¤ºç©ºçŠ¶æ€ï¼ˆå¯æ ¹æ®éœ€è¦æ·»åŠ é»˜è®¤æ•°æ®ï¼‰
                return [{
                    name: "ç›®å½•åŠ è½½å¤±è´¥",
                    path: "",
                    type: "file",
                    updated: new Date().getTime(),
                    updatedAt: new Date().toISOString()
                }];
            }
        }

        /**
         * æ¸²æŸ“åšå®¢åˆ—è¡¨ï¼ˆæ ¸å¿ƒå‡½æ•°ï¼‰
         */
        async function renderBlogList() {
            // 1. è·å–å½“å‰è·¯å¾„ä¸‹çš„æ–‡ä»¶/æ–‡ä»¶å¤¹æ•°æ®
            const fileList = await fetchGithubFiles(currentPath);
            // 2. æŒ‰æ›´æ–°æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            const sortedList = [...fileList].sort((a, b) => b.updated - a.updated);

            // 3. æ›´æ–° DOM å…ƒç´ 
            const blogListEl = document.getElementById("blog-list");
            const pathDisplayEl = document.getElementById("current-path");
            const totalCountEl = document.getElementById("total-count");

            // æ¸…ç©ºåˆ—è¡¨
            blogListEl.innerHTML = "";

            // æ›´æ–°å½“å‰ç›®å½•æ˜¾ç¤º
            pathDisplayEl.textContent = currentPath 
                ? `å½“å‰ç›®å½•ï¼š/blog/${currentPath}` 
                : "åšå®¢æ ¹ç›®å½•";

            // æ›´æ–°æ€»æ•°æ˜¾ç¤º
            totalCountEl.textContent = fileList.length;

            // 4. æ¸²æŸ“ã€Œè¿”å›ä¸Šçº§ã€æŒ‰é’®ï¼ˆéæ ¹ç›®å½•æ—¶æ˜¾ç¤ºï¼‰
            if (currentPath) {
                const backItem = document.createElement("div");
                backItem.className = "blog-item";
                backItem.innerHTML = `
                    <a href="#" class="blog-link">
                        <i class="fa fa-level-up mr-2"></i>
                        <span>../ è¿”å›ä¸Šçº§ç›®å½•</span>
                        <span class="updated-time">${formatDate(new Date())}</span>
                    </a>
                `;
                // ç‚¹å‡»è¿”å›ä¸Šçº§
                backItem.addEventListener("click", (e) => {
                    e.preventDefault();
                    // è®¡ç®—ä¸Šçº§è·¯å¾„ï¼ˆç§»é™¤æœ€åä¸€çº§ç›®å½•ï¼‰
                    const pathParts = currentPath.split("/").filter(Boolean);
                    pathParts.pop();
                    currentPath = pathParts.join("/") || "";
                    renderBlogList();
                });
                blogListEl.appendChild(backItem);
            }

            // 5. æ¸²æŸ“æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ—è¡¨
            sortedList.forEach(item => {
                const itemEl = document.createElement("div");
                itemEl.className = "blog-item";

                // åŒºåˆ†æ–‡ä»¶/æ–‡ä»¶å¤¹å›¾æ ‡å’Œé“¾æ¥
                const iconClass = item.type === "dir" ? "fa-folder" : "fa-file-text-o";
                const itemLink = item.type === "dir" 
                    ? "#" // æ–‡ä»¶å¤¹ç‚¹å‡»ç”± JS å¤„ç†
                    : `/${GITHUB_CONFIG.baseDir}${item.path}`; // HTML æ–‡ä»¶ç›´æ¥è·³è½¬

                // æ ¼å¼åŒ–æ›´æ–°æ—¶é—´
                const formattedDate = formatDate(new Date(item.updated));

                // æ„å»º DOM ç»“æ„
                itemEl.innerHTML = `
                    <a href="${itemLink}" class="blog-link">
                        <i class="fa ${iconClass} mr-2"></i>
                        <span>${item.name}${item.type === "dir" ? "/" : ""}</span>
                        <span class="updated-time">${formattedDate}</span>
                    </a>
                `;

                // æ–‡ä»¶å¤¹ç‚¹å‡»äº‹ä»¶ï¼ˆè¿›å…¥å­ç›®å½•ï¼‰
                if (item.type === "dir") {
                    itemEl.addEventListener("click", (e) => {
                        e.preventDefault();
                        // æ›´æ–°å½“å‰è·¯å¾„ä¸ºæ–‡ä»¶å¤¹è·¯å¾„
                        currentPath = item.path;
                        renderBlogList();
                    });
                }

                blogListEl.appendChild(itemEl);
            });
        }

        /**
         * æ ¼å¼åŒ–æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
         * @param {Date} date - æ—¥æœŸå¯¹è±¡
         * @returns {string} æ ¼å¼åŒ–åçš„æ—¥æœŸå­—ç¬¦ä¸²
         */
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const day = String(date.getDate()).padStart(2, "0");
            return `${year}-${month}-${day}`;
        }
    </script>
    <!-- åšå®¢ç›®å½•ç‰¹æœ‰æ ·å¼ï¼ˆè¡¥å……é€šç”¨æ ·å¼ï¼‰ -->
    <style>
        .blog-header {
            margin-bottom: 2rem;
            text-align: center;
        }

        .blog-header h1 {
            font-size: 2rem;
            margin-bottom: 0.8rem;
            border-bottom: none;
        }

        .path-display {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1.2rem;
            font-style: italic;
            font-size: 0.95rem;
        }

        .directory-info {
            margin: 1rem 0 1.5rem;
            padding: 0.8rem 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .blog-list {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .blog-item {
            padding: 0.8rem 1rem;
            border-radius: 6px;
            transition: background-color 0.25s ease;
        }

        .blog-item:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        .blog-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            color: white !important;
            text-decoration: none !important;
        }

        .updated-time {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            white-space: nowrap;
            margin-left: 1rem;
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 640px) {
            .blog-link {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.3rem;
            }

            .updated-time {
                margin-left: 0;
                margin-top: 0.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆªï¼ˆä¸åšå®¢æ–‡ç« é¡µé¢ä¸€è‡´ï¼‰ -->
        <nav class="glass">
            <div class="nav-container">
                <a href="/index.html" class="site-title">
                    <i class="fa fa-home mr-2"></i>æ²æ³½çš„åšå®¢
                </a>
                <div class="nav-links">
                    <a href="/index.html"><i class="fa fa-home"></i> é¦–é¡µ</a>
                    <a href="/blog.html" class="text-accent"><i class="fa fa-book"></i> åšå®¢ç›®å½•</a>
                    <a href="/contact.html"><i class="fa fa-envelope"></i> è”ç³»</a>
                    <a href="/links.html"><i class="fa fa-link"></i> é“¾æ¥</a>
                </div>
            </div>
        </nav>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="glass">
            <div class="blog-header">
                <h1>åšå®¢ç›®å½•</h1>
                <div class="directory-info">
                    å…± <span id="total-count">0</span> ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹ Â· æŒ‰æ›´æ–°æ—¶é—´æ’åºï¼ˆæœ€æ–°é å‰ï¼‰
                </div>
                <div class="path-display" id="current-path">åšå®¢æ ¹ç›®å½•</div>
            </div>

            <!-- åšå®¢åˆ—è¡¨ï¼ˆJS åŠ¨æ€ç”Ÿæˆï¼‰ -->
            <div class="blog-list" id="blog-list"></div>
        </main>

        <!-- é¡µè„šï¼ˆä¸åšå®¢æ–‡ç« é¡µé¢ä¸€è‡´ï¼‰ -->
        <footer class="glass">
            <div class="mb-2">
                <a href="https://icp.gov.moe/?keyword=20254447" target="_blank" class="icp-link">
                    <img src="https://icp.gov.moe/images/ico64.png" alt="èŒICPå¤‡æ¡ˆæ ‡è¯†" style="width: 16px; height: 16px;">
                    èŒICPå¤‡20254447å·
                </a>
            </div>
            <div class="mb-2">
                <a href="https://travel.moe/go.html" title="å¼‚æ¬¡å…ƒä¹‹æ—…-è·ƒè¿-æˆ‘ä»¬ä¸€èµ·å»èŒç«™æˆå‘˜çš„æ˜Ÿçƒæ—…è¡Œå§ï¼" target="_blank" class="travel-link">
                    <img src="https://travel.moe/images/icon/icon64pink.png" style="width:20px;height:20px;margin-right:4px;">å¼‚æ¬¡å…ƒä¹‹æ—…ğŸš€
                </a>
            </div>
            <div>Â© 2025 zzzleeper | <a href="/index.html">å›åˆ°é¦–é¡µ</a></div>
        </footer>
    </div>
</body>
</html>
