<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åšå®¢ç›®å½• - æ²æ³½</title>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="blog-style.css">
    <script>
        // ä¿®æ­£ä¸ºæ­£ç¡®çš„GitHubä»“åº“é…ç½®
        const GITHUB_CONFIG = {
            owner: "zzzleepers",  // ä¿®æ­£ç”¨æˆ·å
            repo: "zzzleepers.github.io",  // ä¿®æ­£ä»“åº“å
            baseDir: "blog/"
        };

        let currentPath = "";
        const dirCache = new Map();

        document.addEventListener('DOMContentLoaded', async () => {
            await renderBlogList();
        });

        async function fetchGithubFiles(path = "") {
            if (dirCache.has(path)) {
                return dirCache.get(path);
            }

            try {
                // ä½¿ç”¨ä¿®æ­£åçš„ä»“åº“ä¿¡æ¯æ„å»ºAPIåœ°å€
                const apiUrl = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.baseDir}${path}`;
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    throw new Error(`è·å–ç›®å½•å¤±è´¥ï¼ˆ${response.status}ï¼‰`);
                }

                const rawData = await response.json();
                const formattedData = rawData
                    .filter(item => {
                        return (item.type === "file" && item.name.endsWith(".html")) || 
                               (item.type === "dir" && !item.name.startsWith("."));
                    })
                    .map(item => ({
                        name: item.type === "file" ? item.name.replace(".html", "") : item.name,
                        path: item.path.replace(GITHUB_CONFIG.baseDir, ""),
                        fullPath: item.path,
                        type: item.type,
                        updated: new Date(item.updated_at).getTime(),
                        updatedAt: item.updated_at
                    }));

                dirCache.set(path, formattedData);
                return formattedData;
            } catch (error) {
                console.error("GitHub API è¯·æ±‚é”™è¯¯ï¼š", error);
                return [{
                    name: "ç›®å½•åŠ è½½å¤±è´¥",
                    path: "",
                    type: "file",
                    updated: new Date().getTime(),
                    updatedAt: new Date().toISOString()
                }];
            }
        }

        async function renderBlogList() {
            const fileList = await fetchGithubFiles(currentPath);
            const sortedList = [...fileList].sort((a, b) => b.updated - a.updated);

            const blogListEl = document.getElementById("blog-list");
            const pathDisplayEl = document.getElementById("current-path");
            const totalCountEl = document.getElementById("total-count");

            blogListEl.innerHTML = "";

            pathDisplayEl.textContent = currentPath 
                ? `å½“å‰ç›®å½•ï¼š/blog/${currentPath}` 
                : "åšå®¢æ ¹ç›®å½•";

            totalCountEl.textContent = fileList.length;

            if (currentPath) {
                const backItem = document.createElement("div");
                backItem.className = "blog-item";
                backItem.innerHTML = `
                    <a href="#" class="blog-link">
                        <i class="fa fa-level-up mr-2"></i>
                        <span>../ è¿”å›ä¸Šçº§ç›®å½•</span>
                        <span class="updated-time">${formatDate(new Date())}</span>
                    </a>
                `;
                backItem.addEventListener("click", (e) => {
                    e.preventDefault();
                    const pathParts = currentPath.split("/").filter(Boolean);
                    pathParts.pop();
                    currentPath = pathParts.join("/") || "";
                    renderBlogList();
                });
                blogListEl.appendChild(backItem);
            }

            sortedList.forEach(item => {
                const itemEl = document.createElement("div");
                itemEl.className = "blog-item";

                const iconClass = item.type === "dir" ? "fa-folder" : "fa-file-text-o";
                // ä¿®æ­£åšå®¢æ–‡ä»¶é“¾æ¥è·¯å¾„
                const itemLink = item.type === "dir" 
                    ? "#" 
                    : `/${GITHUB_CONFIG.baseDir}${item.path}`;

                const formattedDate = formatDate(new Date(item.updated));

                itemEl.innerHTML = `
                    <a href="${itemLink}" class="blog-link">
                        <i class="fa ${iconClass} mr-2"></i>
                        <span>${item.name}${item.type === "dir" ? "/" : ""}</span>
                        <span class="updated-time">${formattedDate}</span>
                    </a>
                `;

                if (item.type === "dir") {
                    itemEl.addEventListener("click", (e) => {
                        e.preventDefault();
                        currentPath = item.path;
                        renderBlogList();
                    });
                }

                blogListEl.appendChild(itemEl);
            });
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const day = String(date.getDate()).padStart(2, "0");
            return `${year}-${month}-${day}`;
        }
    </script>
    <style>
        .blog-header {
            margin-bottom: 2rem;
            text-align: center;
        }

        .blog-header h1 {
            font-size: 2rem;
            margin-bottom: 0.8rem;
            border-bottom: none;
        }

        .path-display {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 1.2rem;
            font-style: italic;
            font-size: 0.95rem;
        }

        .directory-info {
            margin: 1rem 0 1.5rem;
            padding: 0.8rem 1rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .blog-list {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .blog-item {
            padding: 0.8rem 1rem;
            border-radius: 6px;
            transition: background-color 0.25s ease;
        }

        .blog-item:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        .blog-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            color: white !important;
            text-decoration: none !important;
        }

        .updated-time {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            white-space: nowrap;
            margin-left: 1rem;
        }

        @media (max-width: 640px) {
            .blog-link {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.3rem;
            }

            .updated-time {
                margin-left: 0;
                margin-top: 0.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="glass">
            <div class="nav-container">
                <!-- ä¿®æ­£é¦–é¡µé“¾æ¥ -->
                <a href="/index.html" class="site-title">
                    <i class="fa fa-home mr-2"></i>æ²æ³½çš„åšå®¢
                </a>
                <div class="nav-links">
                    <a href="/index.html"><i class="fa fa-home"></i> é¦–é¡µ</a>
                    <a href="/blog.html" class="text-accent"><i class="fa fa-book"></i> åšå®¢ç›®å½•</a>
                    <a href="/contact.html"><i class="fa fa-envelope"></i> è”ç³»</a>
                    <a href="/links.html"><i class="fa fa-link"></i> é“¾æ¥</a>
                </div>
            </div>
        </nav>

        <main class="glass">
            <div class="blog-header">
                <h1>åšå®¢ç›®å½•</h1>
                <div class="directory-info">
                    å…± <span id="total-count">0</span> ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹ Â· æŒ‰æ›´æ–°æ—¶é—´æ’åºï¼ˆæœ€æ–°é å‰ï¼‰
                </div>
                <div class="path-display" id="current-path">åšå®¢æ ¹ç›®å½•</div>
            </div>

            <div class="blog-list" id="blog-list"></div>
        </main>

        <footer class="glass">
            <div class="mb-2">
                <a href="https://icp.gov.moe/?keyword=20254447" target="_blank" class="icp-link">
                    <img src="https://icp.gov.moe/images/ico64.png" alt="èŒICPå¤‡æ¡ˆæ ‡è¯†" style="width: 16px; height: 16px;">
                    èŒICPå¤‡20254447å·
                </a>
            </div>
            <div class="mb-2">
                <a href="https://travel.moe/go.html" title="å¼‚æ¬¡å…ƒä¹‹æ—…-è·ƒè¿-æˆ‘ä»¬ä¸€èµ·å»èŒç«™æˆå‘˜çš„æ˜Ÿçƒæ—…è¡Œå§ï¼" target="_blank" class="travel-link">
                    <img src="https://travel.moe/images/icon/icon64pink.png" style="width:20px;height:20px;margin-right:4px;">å¼‚æ¬¡å…ƒä¹‹æ—…ğŸš€
                </a>
            </div>
            <!-- ä¿®æ­£ç‰ˆæƒä¿¡æ¯ä¸­çš„ç”¨æˆ·å -->
            <div>Â© 2025 zzzleepers | <a href="/index.html">å›åˆ°é¦–é¡µ</a></div>
        </footer>
    </div>
</body>
</html>
